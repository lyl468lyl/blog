<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <link rel="icon" href="/blog/logo.ico"><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>sass(aps)开发文档 | 工作学习记录</title><meta name="description" content="">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/blog/assets/style-6b63528b.css" as="style"><link rel="stylesheet" href="/blog/assets/style-6b63528b.css">
    <link rel="modulepreload" href="/blog/assets/app-c74164ac.js"><link rel="modulepreload" href="/blog/assets/erpnext sass化.html-c020bdcd.js"><link rel="modulepreload" href="/blog/assets/erpnext sass化.html-f2330b45.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="vp-navbar" id="navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/blog/" class="vp-brand"><img class="vp-nav-logo" src="/blog/avatar.png" alt="工作学习记录"><!----><span class="vp-site-name hide-in-pad">工作学习记录</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link active" aria-label="笔记"><!---->笔记<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/nav.html" class="nav-link" aria-label="导航"><!---->导航<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item"><a class="vp-repo-link" href="https://github.com/lyl468lyl/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="vp-page" id="main-content"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->sass(aps)开发文档</h1><div class="page-info"><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-08-17T11:09:30.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 11 分钟</span><meta property="timeRequired" content="PT11M"></span></div><hr></div><!----><!----><div class="theme-hope-content"><p>date: 2013-7-19</p><p>category: sass</p><p>tag:</p><ul><li>sass</li></ul><h1 id="sass-aps-开发文档" tabindex="-1"><a class="header-anchor" href="#sass-aps-开发文档" aria-hidden="true">#</a> sass(aps)开发文档</h1><h4 id="前提准备" tabindex="-1"><a class="header-anchor" href="#前提准备" aria-hidden="true">#</a> 前提准备</h4><p>参考:https://www.yuque.com/leifengyang/oncloud/ctiwgo#gSYVF</p><ol><li>创建aws 云主机</li></ol><p>2)设置主机密码登录</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment"># 编辑ssh 配置文件</span>
vi <span class="token operator">/</span>etc<span class="token operator">/</span>ssh<span class="token operator">/</span>sshd_config

<span class="token comment">#PasswordAuthentication 将no改成yes</span>
PasswordAuthentication yes

<span class="token comment">#重启ssh</span>
sudo service ssh restart

<span class="token comment">#设置用户名和密码</span>
adduser aps
密码<span class="token punctuation">:</span>zxc<span class="token filehandle symbol">&lt;&gt;</span><span class="token operator">?</span><span class="token number">123</span>

sudo passwd aps

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="一-安装docker-compose-最新版-192-168-50-230" tabindex="-1"><a class="header-anchor" href="#一-安装docker-compose-最新版-192-168-50-230" aria-hidden="true">#</a> 一 .安装docker-compose 最新版(192.168.50.230)</h4><ol><li><p>compse稳定版</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>sudo curl <span class="token operator">-</span>L <span class="token string">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot;</span> <span class="token operator">-o</span> <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose

sudo chmod <span class="token operator">+</span><span class="token operator">x</span> <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose

docker<span class="token operator">-</span>compose <span class="token operator">--</span>version

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>安装erpnext</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#下载</span>
git clone https<span class="token punctuation">:</span><span class="token operator">//</span>gitee<span class="token operator">.</span>com<span class="token operator">/</span>yuzelin<span class="token operator">/</span>erpnext_oob_docker <span class="token operator">&amp;&amp;</span> cd erpnext_oob_docker

cd <span class="token operator">/</span>opt<span class="token operator">/</span>software<span class="token operator">/</span>frappe_docker
<span class="token comment">#安装</span>
docker<span class="token operator">-</span>compose <span class="token operator">--</span>project<span class="token operator">-</span>name erpnext_oob <span class="token operator">-f</span> pwd<span class="token operator">.</span>yml up <span class="token operator">-d</span>

<span class="token comment">#访问</span>
http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">192.168.50.230</span><span class="token operator">/</span>login<span class="token comment">#login</span>

<span class="token comment">#用户名和密码</span>
<span class="token comment">#administrator,密码admin登录系统</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>报错</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># docker login -u &quot;${DOCKER_USER}&quot; -p &quot;${DOCKER_PASS}&quot; &quot;${DOCKER_URL}&quot;</span>
<span class="token key atrule">error getting credentials - err</span><span class="token punctuation">:</span> exit status 1<span class="token punctuation">,</span> <span class="token key atrule">out</span><span class="token punctuation">:</span> `Cannot autolaunch D<span class="token punctuation">-</span>Bus without X11 $DISPLAY`
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解决:</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>rm <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>credential<span class="token operator">-</span>secretservice
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>停止所有的docker</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>docker<span class="token operator">-</span>compose <span class="token operator">--</span>project<span class="token operator">-</span>name erpnext_oob <span class="token operator">-f</span> pwd<span class="token operator">.</span>yml down
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>查看compose中yaml文件中创建的卷标</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> root<span class="token variable">@shangjian</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token comment"># docker volume ls |grep db-data</span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> root<span class="token variable">@shangjian</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token comment"># docker volume inspect erpnext_oob_db-data</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2023-08-15T14:01:17+08:00&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;local&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Labels&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;com.docker.compose.project&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;erpnext_oob&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;com.docker.compose.version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2.20.2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;com.docker.compose.volume&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;db-data&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/var/lib/docker/volumes/erpnext_oob_db-data/_data&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;erpnext_oob_db-data&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Options&quot;</span><span class="token punctuation">:</span> null<span class="token punctuation">,</span>
        <span class="token string">&quot;Scope&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>docker 查看内部占用的端口</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>docker exec <span class="token operator">-</span>it 23db451681a3 ss <span class="token operator">-</span>tuln
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ubuntu20.04 部署k8s</p><ol><li>环境初始化</li></ol><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment"># 关闭SWAP</span>
swapoff <span class="token operator">-</span>a
rm <span class="token operator">-f</span> <span class="token operator">/</span>swap<span class="token operator">.</span>img
vim <span class="token operator">/</span>etc<span class="token operator">/</span>fstab
<span class="token comment"># /swap.img                         注释掉</span>

<span class="token comment"># 开启IP转发</span>
vim <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token operator">.</span>conf
net<span class="token operator">.</span>ip<span class="token v-string string">v4</span><span class="token operator">.</span>ip_forward<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># 查看状态</span>
sysctl <span class="token operator">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>安装docker</li></ol><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#安装依赖</span>
sudo apt<span class="token operator">-</span>get update
sudo apt<span class="token operator">-</span>get <span class="token operator">-</span>y install apt<span class="token operator">-</span>transport<span class="token operator">-</span>https ca<span class="token operator">-</span>certificates curl software<span class="token operator">-</span>properties<span class="token operator">-</span>common
<span class="token comment">#安装GPG证书</span>
curl <span class="token operator">-</span>fsSL https<span class="token punctuation">:</span><span class="token operator">//</span>mirrors<span class="token operator">.</span>aliyun<span class="token operator">.</span>com<span class="token regex">/docker-ce/linu</span><span class="token operator">x</span><span class="token regex">/ubuntu/gpg</span> <span class="token operator">|</span> sudo apt<span class="token operator">-</span>key add <span class="token operator">-</span>

<span class="token comment">#写入软件源信息</span>
sudo add<span class="token operator">-</span>apt<span class="token operator">-</span>repository <span class="token string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span>

<span class="token comment">#更新安装docker</span>
sudo apt<span class="token operator">-</span>get <span class="token operator">-</span>y update
apt install <span class="token operator">-</span>y docker<span class="token operator">-</span>ce

<span class="token comment">#安装docker-compose</span>
apt install <span class="token operator">-</span>y docker<span class="token operator">-</span>compose

<span class="token comment">#安装docker开机启动</span>
systemctl enable docker

<span class="token comment">#配置镜像</span>

$ cat <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>docker<span class="token operator">/</span>daemon<span class="token operator">.</span>json <span class="token operator">&lt;&lt;</span> EOF
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://b9pmyelo.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF

<span class="token comment">#查看docker 版本</span>
docker <span class="token operator">--</span>version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>安装k8s</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#添加证书</span>
curl https<span class="token punctuation">:</span><span class="token operator">//</span>mirrors<span class="token operator">.</span>aliyun<span class="token operator">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>apt<span class="token operator">/</span>doc<span class="token operator">/</span>apt<span class="token operator">-</span>key<span class="token operator">.</span>gpg <span class="token operator">|</span> apt<span class="token operator">-</span>key add <span class="token operator">-</span> 

<span class="token comment">#添加apt源</span>
cat <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">&gt;</span><span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>sources<span class="token operator">.</span>list<span class="token operator">.</span>d<span class="token operator">/</span>kubernetes<span class="token operator">.</span>list
deb https<span class="token punctuation">:</span><span class="token operator">//</span>mirrors<span class="token operator">.</span>aliyun<span class="token operator">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>apt<span class="token operator">/</span> kubernetes<span class="token operator">-</span>xenial main
EOF

apt<span class="token operator">-</span>get update

<span class="token comment">#查看可安装版本</span>
apt<span class="token operator">-</span>cache madison kubelet

<span class="token comment">#安装指定的版本</span>
apt<span class="token operator">-</span>get install <span class="token operator">-</span>y kubelet<span class="token operator">=</span><span class="token v-string string">1.20.9</span><span class="token operator">-</span><span class="token number">00</span> kubeadm<span class="token operator">=</span><span class="token v-string string">1.20.9</span><span class="token operator">-</span><span class="token number">00</span> kubectl<span class="token operator">=</span><span class="token v-string string">1.20.9</span><span class="token operator">-</span><span class="token number">00</span>

<span class="token comment">#设置开机自启动</span>
sudo systemctl enable kubelet <span class="token operator">&amp;&amp;</span> sudo systemctl start kubelet

<span class="token comment">#查看所需的镜像</span>
kubeadm config images list <span class="token operator">--</span>kubernetes<span class="token operator">-</span>version<span class="token operator">=</span><span class="token v-string string">v1.20.9</span>

k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>apiserver<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>scheduler<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>pause<span class="token punctuation">:</span><span class="token number">3.2</span>
k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>etcd<span class="token punctuation">:</span><span class="token v-string string">3.4.13</span><span class="token operator">-</span><span class="token number">0</span>
k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>coredns<span class="token punctuation">:</span><span class="token v-string string">1.7.0</span>

<span class="token comment">#从新地址下载镜像(将上面的地址换成下面的)</span>

docker pull registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>apiserver<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker pull registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker pull registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>scheduler<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker pull registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker pull registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>pause<span class="token punctuation">:</span><span class="token number">3.2</span>
docker pull registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>etcd<span class="token punctuation">:</span><span class="token v-string string">3.4.13</span><span class="token operator">-</span><span class="token number">0</span>
docker pull registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>coredns<span class="token punctuation">:</span><span class="token v-string string">1.7.0</span>

<span class="token comment">#为镜像重新打Tag(重新命名上面拉取的镜像)</span>
docker tag registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>apiserver<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span> k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>apiserver<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker tag registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span> k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker tag registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>scheduler<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span> k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>scheduler<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker tag registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span> k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">:</span><span class="token v-string string">v1.20.9</span>
docker tag registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>pause<span class="token punctuation">:</span><span class="token number">3.2</span> k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>pause<span class="token punctuation">:</span><span class="token number">3.2</span>
docker tag registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>etcd<span class="token punctuation">:</span><span class="token v-string string">3.4.13</span><span class="token operator">-</span><span class="token number">0</span> k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>etcd<span class="token punctuation">:</span><span class="token v-string string">3.4.13</span><span class="token operator">-</span><span class="token number">0</span>
docker tag registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>coredns<span class="token punctuation">:</span><span class="token v-string string">1.7.0</span> k8s<span class="token operator">.</span>gcr<span class="token operator">.</span>io<span class="token operator">/</span>coredns<span class="token punctuation">:</span><span class="token v-string string">1.7.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>主节点初始化</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#所有机器添加master域名映射,以下需要修改为自己的</span>
echo <span class="token string">&quot;172.31.75.125  cluster-endpoint&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts

kubeadm init <span class="token operator">\</span>
<span class="token operator">--</span>apiserver<span class="token operator">-</span>advertise<span class="token operator">-</span>address<span class="token operator">=</span><span class="token v-string string">172.31.75.125</span> <span class="token operator">\</span>
<span class="token operator">--</span>control<span class="token operator">-</span>plane<span class="token operator">-</span>endpoint<span class="token operator">=</span>cluster<span class="token operator">-</span>endpoint<span class="token operator">\</span>
<span class="token operator">--</span>service<span class="token operator">-</span>cidr<span class="token operator">=</span><span class="token v-string string">10.96.0.0</span><span class="token operator">/</span><span class="token number">16</span> <span class="token operator">\</span>
<span class="token operator">--</span>pod<span class="token operator">-</span>network<span class="token operator">-</span>cidr<span class="token operator">=</span><span class="token v-string string">192.168.0.0</span><span class="token operator">/</span><span class="token number">16</span>


kubeadm init <span class="token operator">--</span>kubernetes<span class="token operator">-</span>version<span class="token operator">=</span><span class="token v-string string">v1.20.9</span> <span class="token operator">--</span>pod<span class="token operator">-</span>network<span class="token operator">-</span>cidr<span class="token operator">=</span><span class="token v-string string">192.168.0.0</span><span class="token operator">/</span><span class="token number">16</span> <span class="token operator">--</span>service<span class="token operator">-</span>cidr<span class="token operator">=</span><span class="token v-string string">10.96.0.0</span><span class="token operator">/</span><span class="token number">16</span> <span class="token operator">--</span>ignore<span class="token operator">-</span>preflight<span class="token operator">-</span>errors<span class="token operator">=</span>Swap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行完主节点配置出现如下提示:</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>Your Kubernetes control<span class="token operator">-</span>plane has initialized successfully<span class="token operator">!</span>             <span class="token comment"># 安装成功的提示</span>

To start using your cluster<span class="token punctuation">,</span> you need to run the following as a regular user<span class="token punctuation">:</span>

  mkdir <span class="token operator">-p</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token operator">.</span>kube
  sudo cp <span class="token operator">-</span>i <span class="token operator">/</span>etc<span class="token regex">/kubernetes/admin</span><span class="token operator">.</span>conf <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token operator">.</span>kube<span class="token operator">/</span>config
  sudo chown <span class="token variable">$(</span>id <span class="token operator">-u</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token variable">$(</span>id <span class="token operator">-g</span><span class="token punctuation">)</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token operator">.</span>kube<span class="token operator">/</span>config

You should now deploy a pod network to the cluster<span class="token operator">.</span>
Run <span class="token string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at<span class="token punctuation">:</span>
  https<span class="token punctuation">:</span><span class="token operator">//</span>kubernetes<span class="token operator">.</span>io<span class="token operator">/</span>docs<span class="token operator">/</span>concepts<span class="token operator">/</span>cluster<span class="token operator">-</span>administration<span class="token regex">/addons/</span>

Then you can join <span class="token keyword">any</span> number of worker nodes by running the following on each as root<span class="token punctuation">:</span>

kubeadm join <span class="token v-string string">192.168.93.136</span><span class="token punctuation">:</span><span class="token number">6443</span> <span class="token operator">--</span>token vvd4zg<span class="token operator">.</span>4ay8rxanmh7fopec <span class="token operator">\</span>
    <span class="token operator">--</span>discovery<span class="token operator">-</span>token<span class="token operator">-</span>ca<span class="token operator">-</span>cert<span class="token operator">-</span>hash sha256<span class="token punctuation">:</span>df77248c6939eb6c6062d50e6e99c4f881f48e619ef4d2e61304a529a4c2eb1f
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装上述提示在master节点上执行</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>  mkdir <span class="token operator">-p</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token operator">.</span>kube
  sudo cp <span class="token operator">-</span>i <span class="token operator">/</span>etc<span class="token regex">/kubernetes/admin</span><span class="token operator">.</span>conf <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token operator">.</span>kube<span class="token operator">/</span>config
  sudo chown <span class="token variable">$(</span>id <span class="token operator">-u</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token variable">$(</span>id <span class="token operator">-g</span><span class="token punctuation">)</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token operator">.</span>kube<span class="token operator">/</span>config
  export KUBECONFIG<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token regex">/kubernetes/admin</span><span class="token operator">.</span>conf
  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时执行命令kubectl get nodes 会报错</p><p>错误:</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code>The connection to the server <span class="token property">localhost</span><span class="token punctuation">:</span>8080 was refused - did you specify the right host or port?
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#解决</span>
<span class="token comment">#在每个节点上操作</span>
将master节点的<span class="token operator">/</span>etc<span class="token regex">/kubernetes/admin</span><span class="token operator">.</span>conf 拷贝到每个节点<span class="token operator">/</span>etc<span class="token regex">/kubernetes/admin</span><span class="token operator">.</span>conf
echo <span class="token string">&quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>profile
<span class="token comment">#生效</span>
source <span class="token operator">/</span>etc<span class="token operator">/</span>profile
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行如下命令kubectl get cs,报错:</p><p>如果出现Get &quot;http://127.0.0.1:10252/healthz&quot;: dial tcp 127.0.0.1:10252: connect: connection refused 错误</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#解决</span>
<span class="token comment">#在master节点执行</span>
vim <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests<span class="token operator">/</span>kube<span class="token operator">-</span>scheduler<span class="token operator">.</span>yaml
<span class="token comment">#将</span>
<span class="token operator">-</span> <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#这行注释掉</span>

vim <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests<span class="token operator">/</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token operator">.</span>yaml
<span class="token comment">#将</span>
<span class="token operator">-</span> <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#这行注释掉</span>

<span class="token comment">#再次执行命令kubectl get cs</span>
<span class="token comment">#如下为正常的结果</span>

NAME                 STATUS    MESSAGE             ERROR
controller<span class="token operator">-</span>manager   Healthy   ok                  
scheduler            Healthy   ok                  
etcd<span class="token operator">-</span><span class="token number">0</span>               Healthy   <span class="token punctuation">{</span><span class="token string">&quot;health&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">}</span> 



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#这时运行 kubectl get node,为noready 需要安装网络插件</span>

<span class="token comment"># -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml(这个需要验证是否能用)</span>

curl https<span class="token punctuation">:</span><span class="token regex">//docs</span><span class="token operator">.</span>projectcalico<span class="token operator">.</span>org<span class="token operator">/</span><span class="token v-string string">v3.20</span><span class="token regex">/manifests/calico</span><span class="token operator">.</span>yaml <span class="token operator">-O</span>
kubectl apply <span class="token operator">-f</span> calico<span class="token operator">.</span>yaml

<span class="token comment">#这时在运行kubectl get node 为ready状态</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建部署:在k8s创建一个pod,验证是否正常</p></li></ol><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>kubectl create deployment nginx <span class="token operator">--</span>image<span class="token operator">=</span>nginx
kubectl expose deployment nginx <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">80</span> <span class="token operator">--</span>type<span class="token operator">=</span>NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="11"><li><p>查询pod 和svc状态</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>kubectl get pod<span class="token punctuation">,</span>svc

root<span class="token variable">@ip</span><span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">70</span><span class="token operator">-</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token comment"># kubectl get pod,svc</span>
NAME                          READY   STATUS    RESTARTS   AGE
pod<span class="token operator">/</span>nginx<span class="token operator">-</span>6799fc88d8<span class="token operator">-</span><span class="token number">22459</span>    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          16h
pod<span class="token operator">/</span>nginx3<span class="token operator">-</span>5465449d99<span class="token operator">-</span>76blm   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          16m

NAME                 TYPE        CLUSTER<span class="token operator">-</span>IP     EXTERNAL<span class="token operator">-</span>IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service<span class="token operator">/</span>kubernetes   ClusterIP   <span class="token v-string string">10.96.0.1</span>      <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">443</span><span class="token operator">/</span>TCP        17h
service<span class="token operator">/</span>nginx        NodePort    <span class="token v-string string">10.96.94.166</span>   <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">30221</span><span class="token operator">/</span>TCP   16h
service<span class="token operator">/</span>nginx3       NodePort    <span class="token v-string string">10.96.3.97</span>     <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">32630</span><span class="token operator">/</span>TCP   16m

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>访问</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">18.206.193.80</span><span class="token punctuation">:</span><span class="token number">30221</span> <span class="token comment">#就能访问nginx</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>kubctl 相关操作</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment"># 获取节点的状态</span>
kubectl get node

<span class="token comment"># 获取pod 状态</span>
kubectl get pod<span class="token punctuation">,</span>svc

<span class="token comment">#获取组件状态</span>
kubectl get cs

<span class="token comment">#部署和暴露端口</span>

kubectl create deployment nginx <span class="token operator">--</span>image<span class="token operator">=</span>nginx
kubectl expose deployment nginx <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">80</span> <span class="token operator">--</span>type<span class="token operator">=</span>NodePort

<span class="token comment">#查看部署</span>
kubectl get deployment
root<span class="token variable">@ip</span><span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">70</span><span class="token operator">-</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token comment"># kubectl get deployment</span>
NAME     READY   UP<span class="token operator">-</span>TO<span class="token operator">-</span>DATE   AVAILABLE   AGE
nginx    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     <span class="token number">1</span>            <span class="token number">1</span>           16h
nginx1   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     <span class="token number">1</span>            <span class="token number">1</span>           37m
nginx3   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     <span class="token number">1</span>            <span class="token number">1</span>           6m31s

<span class="token comment">#删除一个部署</span>
root<span class="token variable">@ip</span><span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">70</span><span class="token operator">-</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token comment"># kubectl delete deployment nginx1</span>
deployment<span class="token operator">.</span>apps <span class="token string">&quot;nginx1&quot;</span> deleted

<span class="token comment">#删除service</span>
<span class="token comment">#查看service的状态</span>
kubectl get pod<span class="token punctuation">,</span>svc

root<span class="token variable">@ip</span><span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">70</span><span class="token operator">-</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token comment"># kubectl get svc</span>
NAME         TYPE        CLUSTER<span class="token operator">-</span>IP      EXTERNAL<span class="token operator">-</span>IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes   ClusterIP   <span class="token v-string string">10.96.0.1</span>       <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">443</span><span class="token operator">/</span>TCP        17h
nginx        NodePort    <span class="token v-string string">10.96.94.166</span>    <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">30221</span><span class="token operator">/</span>TCP   16h
nginx1       NodePort    <span class="token v-string string">10.96.156.183</span>   <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">81</span><span class="token punctuation">:</span><span class="token number">31116</span><span class="token operator">/</span>TCP   40m
nginx3       NodePort    <span class="token v-string string">10.96.3.97</span>      <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">32630</span><span class="token operator">/</span>TCP   9m33s

<span class="token comment">#我们要删除service nginx1</span>
 kubectl <span class="token keyword">delete</span> svc nginx1
kubectl <span class="token keyword">delete</span> svc nginx<span class="token operator">-</span>service

<span class="token comment">#k8s 查看命名空间</span>
kubectl get namespace 
<span class="token comment">#k8s 创建命名空间</span>
kubectl create ns liyulong

<span class="token comment">#查看命名空间的pod</span>
kubectl get pods <span class="token operator">-</span>n liyulong

<span class="token comment">#在命名空间创建pod</span>
kubectl run <span class="token keyword">my</span><span class="token operator">-</span>pod <span class="token operator">--</span>image<span class="token operator">=</span>nginx <span class="token operator">--</span>namespace<span class="token operator">=</span>liyulong

<span class="token comment">#在指定的命名空间中创建两个副本的部署</span>
 kubectl create deployment <span class="token keyword">my</span><span class="token operator">-</span>deployment <span class="token operator">--</span>image<span class="token operator">=</span>nginx <span class="token operator">--</span>replicas<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">--</span>namespace<span class="token operator">=</span>liyulong
 
<span class="token comment">#用负载均衡的方式暴露这两个部署</span>
kubectl expose deployment <span class="token keyword">my</span><span class="token operator">-</span>deployment <span class="token operator">--</span>type<span class="token operator">=</span>LoadBalancer <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">80</span> <span class="token operator">--</span>namespace<span class="token operator">=</span>liyulong

<span class="token comment">#进入pod 内部</span>
kubectl exec <span class="token operator">-</span>it <span class="token keyword">my</span><span class="token operator">-</span>deployment<span class="token operator">-</span>57d86476b6<span class="token operator">-</span>skh2s <span class="token operator">--</span>namespace<span class="token operator">=</span>liyulong <span class="token operator">--</span> <span class="token operator">/</span>bin<span class="token operator">/</span>sh

<span class="token comment">#查看命名空间的service</span>
kubectl get svc <span class="token operator">--</span>namespace<span class="token operator">=</span>liyulong

<span class="token comment">#查看所有空间的pod</span>
kubectl get pods <span class="token operator">--</span>all<span class="token operator">-</span>namespaces

<span class="token comment">#应用dashboard</span>
kubectl apply <span class="token operator">-f</span> recommended<span class="token operator">.</span>yaml
<span class="token comment">#dashbord  删除dashboard</span>
kubectl <span class="token keyword">delete</span> <span class="token operator">-f</span> recommended<span class="token operator">.</span>yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建k8s dashboard</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#下载dashboard</span>

wget https<span class="token punctuation">:</span><span class="token operator">//</span>raw<span class="token operator">.</span>githubusercontent<span class="token operator">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>dashboard<span class="token operator">/</span><span class="token v-string string">v2.3.1</span><span class="token operator">/</span>aio<span class="token operator">/</span>deploy<span class="token operator">/</span>recommended<span class="token operator">.</span>yaml

<span class="token comment">#修改配置</span>

kind<span class="token punctuation">:</span> Service
apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> kubernetes<span class="token operator">-</span>dashboard
  name<span class="token punctuation">:</span> kubernetes<span class="token operator">-</span>dashboard
  namespace<span class="token punctuation">:</span> kubernetes<span class="token operator">-</span>dashboard
spec<span class="token punctuation">:</span>
  type<span class="token punctuation">:</span> NodePort  <span class="token comment"># 新增</span>
  ports<span class="token punctuation">:</span>
    <span class="token operator">-</span> port<span class="token punctuation">:</span> <span class="token number">443</span>
      targetPort<span class="token punctuation">:</span> <span class="token number">8443</span>
      nodePort<span class="token punctuation">:</span> <span class="token number">30001</span>  <span class="token comment"># 新增</span>
  selector<span class="token punctuation">:</span>
    k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> kubernetes<span class="token operator">-</span>dashboard

<span class="token comment">#应用配置</span>
kubectl apply <span class="token operator">-f</span> recommended<span class="token operator">.</span>yaml

<span class="token comment">#查看相应的状态</span>


<span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#查看dashboard 的pod信息</span>
kubectl get pod <span class="token operator">-A</span> <span class="token operator">|</span>grep kubernetes<span class="token operator">-</span>dashboard

kubernetes<span class="token operator">-</span>dashboard   dashboard<span class="token operator">-</span>metrics<span class="token operator">-</span>scraper<span class="token operator">-</span>79c5968bdc<span class="token operator">-</span>bnvss   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          51m
kubernetes<span class="token operator">-</span>dashboard   kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>658485d5c7<span class="token operator">-</span>pq55z        <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          51m

<span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">#查看dashboard 暴露的服务</span>
kubectl get svc <span class="token operator">-A</span> <span class="token operator">|</span>grep kubernetes<span class="token operator">-</span>dashboard

<span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#查看kubernetes-dashboard-658485d5c7-pq55z的log信息</span>
kubectl logs <span class="token operator">-f</span> <span class="token operator">-</span>n kubernetes<span class="token operator">-</span>dashboard kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>658485d5c7<span class="token operator">-</span>pq55z


<span class="token comment">#登录ui</span>
https<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">3.238.176.211</span><span class="token punctuation">:</span><span class="token number">30001</span><span class="token operator">/</span><span class="token comment">#/login  一定是https请求,否则无响应</span>

<span class="token comment">#创建管理员token，可查看任何空间权限</span>

kubectl create clusterrolebinding dashboard<span class="token operator">-</span>cluster<span class="token operator">-</span>admin  <span class="token operator">--</span>clusterrole<span class="token operator">=</span>cluster<span class="token operator">-</span>admin <span class="token operator">--</span>serviceaccount<span class="token operator">=</span>kubernetes<span class="token operator">-</span>dashboard<span class="token punctuation">:</span>kubernetes<span class="token operator">-</span>dashboard

<span class="token comment">#查看kubernetes-dashboard名称空间下的secret</span>
kubectl get secret <span class="token operator">-</span>n kubernetes<span class="token operator">-</span>dashboard

admin<span class="token operator">-</span>token<span class="token operator">-</span>mpskd                  kubernetes<span class="token operator">.</span>io<span class="token operator">/</span>service<span class="token operator">-</span>account<span class="token operator">-</span>token   <span class="token number">3</span>      2m55s
<span class="token keyword">default</span><span class="token operator">-</span>token<span class="token operator">-</span>87n6p                kubernetes<span class="token operator">.</span>io<span class="token operator">/</span>service<span class="token operator">-</span>account<span class="token operator">-</span>token   <span class="token number">3</span>      22m
kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>certs         Opaque                                <span class="token number">0</span>      22m
kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>csrf          Opaque                                <span class="token number">1</span>      22m
kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>key<span class="token operator">-</span>holder    Opaque                                <span class="token number">2</span>      22m
kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>token<span class="token operator">-</span>67vpt   kubernetes<span class="token operator">.</span>io<span class="token operator">/</span>service<span class="token operator">-</span>account<span class="token operator">-</span>token   <span class="token number">3</span>      22m

<span class="token comment">#找到对应的带有token的kubernetes-dashboard-token-67vpt</span>
kubectl describe secret kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>token<span class="token operator">-</span>67vpt <span class="token operator">-</span>n kubernetes<span class="token operator">-</span>dashboard

eyJhbGciOiJSUzI1NiIsImtpZCI6Ilc4Tm1oakpEMDJSNDhSQVlSWDhSTTR5dm5FVjc2SGVBZTExQVhLQklOX0EifQ<span class="token operator">.</span>eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC10b2tlbi1scG5obCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjYzMGQyNzYxLTA3ZTMtNDVhOS05NjczLWUyMGZmYmIxNWExZSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDprdWJlcm5ldGVzLWRhc2hib2FyZCJ9<span class="token operator">.</span>r80pKVeOVPxrZVBs0MUFjMNC<span class="token operator">-</span>SfaMgO<span class="token operator">-</span>9j4GdLoM8udcFZUAx16DgVvY8RirouEZx7jvFbw2ycUWr6IDWiqgx4KKR7cAfpZ2J4OpxUniUlZnhZKEJvWQtvFzfWpygCJctcL30NIGUHTEz1IF5VmQ7Ngb<span class="token operator">-</span>AGcwfLFFr6D5cwr2ScRDpVPWCXrUNi2te9SLhEFGob4AXVSLj8oH9WgbKE1SuCbf0LYbHWK2eRSRtWjQsh0UobeGLU0JwDnP_tiMpDV4<span class="token operator">-</span>3q4ns54NdW_AbR8eLbNB6IvMAyiJTwsY3hd1i9WPP0Z1GLIwjl9OvbLEb6KOKzDnLeydEKffo1ngf6jdJByw

<span class="token comment">#将生成的token 复制到页面中,进行登录</span>
https<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">3.238.176.211</span><span class="token punctuation">:</span><span class="token number">30001</span><span class="token operator">/</span><span class="token comment">#/secret?namespace=default</span>

<span class="token comment">#创建pod ,新建httpd.yml,如下</span>
apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Pod
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> pod<span class="token operator">-</span>httpd
  namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> httpdlab
spec<span class="token punctuation">:</span>
  nodeName<span class="token punctuation">:</span>ip<span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span><span class="token number">176</span>
  containers<span class="token punctuation">:</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> httpd
    image<span class="token punctuation">:</span> httpd<span class="token punctuation">:</span>latest
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent

<span class="token comment">#执行</span>
kubectl apply <span class="token operator">-f</span> httpd<span class="token operator">.</span>yml

<span class="token comment">#查看</span>
kubectl get pods





<span class="token comment">#修改访问端口</span>
kubectl edit svc kubernetes<span class="token operator">-</span>dashboard <span class="token operator">-</span>n kubernetes<span class="token operator">-</span>dashboard




</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>dashboard 日志查看</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#查看dashboard 的pod信息</span>
kubectl get pod <span class="token operator">-A</span> <span class="token operator">|</span>grep kubernetes<span class="token operator">-</span>dashboard

kubernetes<span class="token operator">-</span>dashboard   dashboard<span class="token operator">-</span>metrics<span class="token operator">-</span>scraper<span class="token operator">-</span>79c5968bdc<span class="token operator">-</span>bnvss   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          51m
kubernetes<span class="token operator">-</span>dashboard   kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>658485d5c7<span class="token operator">-</span>pq55z        <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running            <span class="token number">0</span>          51m

<span class="token comment">#查看dashboard 暴露的服务</span>
kubectl get svc <span class="token operator">-A</span> <span class="token operator">|</span>grep kubernetes<span class="token operator">-</span>dashboard

<span class="token comment">#查看kubernetes-dashboard-658485d5c7-pq55z的log信息</span>
kubectl logs <span class="token operator">-f</span> <span class="token operator">-</span>n kubernetes<span class="token operator">-</span>dashboard kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>658485d5c7<span class="token operator">-</span>pq55z
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>nginx yaml 部署实例</p><ol><li>node port 方式部署</li></ol><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>servie
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>service
  <span class="token comment"># 命名空间，没有可以删除，默认是default</span>
  namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
spec<span class="token punctuation">:</span>
  ports<span class="token punctuation">:</span>
  <span class="token comment"># 对外暴露的端口</span>
  <span class="token operator">-</span> nodePort<span class="token punctuation">:</span> <span class="token number">30002</span>
    port<span class="token punctuation">:</span> <span class="token number">80</span>
    protocol<span class="token punctuation">:</span> TCP
    targetPort<span class="token punctuation">:</span> <span class="token number">80</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
  <span class="token comment"># NodePort类型可以对外暴露端口</span>
  type<span class="token punctuation">:</span> NodePort

<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span><span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>deploy
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>deploy
  namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">1</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
      namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
    <span class="token comment"># 镜像名称</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token v-string string">1.22.0</span>
        name<span class="token punctuation">:</span> nginx
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
        resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>configmap 方式</li></ol><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment"># 1) 定义nginx的configmap配置</span>

apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> ConfigMap
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>configmap
data<span class="token punctuation">:</span>
  nginx_conf<span class="token punctuation">:</span> <span class="token operator">|</span><span class="token operator">-</span>
    <span class="token comment">#user  nobody;</span>
    worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>
    events <span class="token punctuation">{</span>
        worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    http <span class="token punctuation">{</span>
        include       mime<span class="token operator">.</span>types<span class="token punctuation">;</span>
        default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
        sendfile        on<span class="token punctuation">;</span>
        keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>
        server <span class="token punctuation">{</span>
            listen       <span class="token number">80</span><span class="token punctuation">;</span>
            server_name  localhost<span class="token punctuation">;</span>
            location <span class="token operator">/</span> <span class="token punctuation">{</span>
                root   html<span class="token punctuation">;</span>
                index  index<span class="token operator">.</span>html index<span class="token operator">.</span>htm<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span>50x<span class="token operator">.</span>html<span class="token punctuation">;</span>
            location <span class="token operator">=</span> <span class="token operator">/</span>50x<span class="token operator">.</span>html <span class="token punctuation">{</span>
                root   html<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># 2) nginx servce和deploy 配置</span>
    apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>servie
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>service
  <span class="token comment"># 命名空间，没有可以删除，默认是default</span>
  namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
spec<span class="token punctuation">:</span>
  ports<span class="token punctuation">:</span>
  <span class="token comment"># 对外暴露的端口</span>
  <span class="token operator">-</span> nodePort<span class="token punctuation">:</span> <span class="token number">30002</span>
    port<span class="token punctuation">:</span> <span class="token number">80</span>
    protocol<span class="token punctuation">:</span> TCP
    targetPort<span class="token punctuation">:</span> <span class="token number">80</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
  <span class="token comment"># NodePort类型可以对外暴露端口</span>
  type<span class="token punctuation">:</span> NodePort

<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span><span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>deploy
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>deploy
  namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">1</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
      namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
    <span class="token comment"># 镜像名称</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token v-string string">1.22.0</span>
        name<span class="token punctuation">:</span> nginx
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
        resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        volumeMounts<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>config
          mountPath<span class="token punctuation">:</span> <span class="token string">&quot;/etc/nginx/conf.d/&quot;</span>
          readOnly<span class="token punctuation">:</span> true
      volumes<span class="token punctuation">:</span>
      <span class="token operator">-</span> name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>config
        configMap<span class="token punctuation">:</span>
          name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>configmap

     
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Ingress 的安装和使用</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment"># 下载ingress</span>
kubectl apply <span class="token operator">-f</span> deploy<span class="token operator">.</span>yaml
<span class="token comment">#修改镜像</span>
vi deploy<span class="token operator">.</span>yaml
<span class="token comment">#将image的值改为如下值：</span>
registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>lfy_k8s_images<span class="token operator">/</span>ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller<span class="token punctuation">:</span><span class="token v-string string">v0.46.0</span>
<span class="token comment">#执行</span>
kubectl apply <span class="token operator">-f</span> deploy<span class="token operator">.</span>yaml

<span class="token comment"># 检查安装的结果</span>
kubectl get pod<span class="token punctuation">,</span>svc <span class="token operator">-</span>n ingress<span class="token operator">-</span>nginx

NAME                                         TYPE        CLUSTER<span class="token operator">-</span>IP      EXTERNAL<span class="token operator">-</span>IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
service<span class="token operator">/</span>ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller             NodePort    <span class="token v-string string">10.96.231.254</span>   <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">31623</span><span class="token operator">/</span>TCP<span class="token punctuation">,</span><span class="token number">443</span><span class="token punctuation">:</span><span class="token number">30811</span><span class="token operator">/</span>TCP   6m34s
service<span class="token operator">/</span>ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller<span class="token operator">-</span>admission   ClusterIP   <span class="token v-string string">10.96.72.253</span>    <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">443</span><span class="token operator">/</span>TCP                      6m34s

<span class="token comment"># 最后别忘记把svc暴露的端口要放行</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Ingress 的使用</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment"># 创建service和depoly</span>
<span class="token comment">#测试环境</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span><span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">2</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> name<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
        image<span class="token punctuation">:</span> registry<span class="token operator">.</span>cn<span class="token operator">-</span>hangzhou<span class="token operator">.</span>aliyuncs<span class="token operator">.</span>com<span class="token operator">/</span>lfy_k8s_images<span class="token operator">/</span>hello<span class="token operator">-</span>server
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">9000</span>
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span><span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">2</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token v-string string">1.22.0</span>
        name<span class="token punctuation">:</span> nginx
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo
spec<span class="token punctuation">:</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo
  ports<span class="token punctuation">:</span>
  <span class="token operator">-</span> port<span class="token punctuation">:</span> <span class="token number">8000</span>
    protocol<span class="token punctuation">:</span> TCP
    targetPort<span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
  name<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
spec<span class="token punctuation">:</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
  ports<span class="token punctuation">:</span>
  <span class="token operator">-</span> port<span class="token punctuation">:</span> <span class="token number">8000</span>
    protocol<span class="token punctuation">:</span> TCP
    targetPort<span class="token punctuation">:</span> <span class="token number">9000</span>
    
<span class="token comment"># 域名访问</span>

apiVersion<span class="token punctuation">:</span> networking<span class="token operator">.</span>k8s<span class="token operator">.</span>io<span class="token operator">/</span><span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Ingress  
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ingress<span class="token operator">-</span>host<span class="token operator">-</span>bar
spec<span class="token punctuation">:</span>
  ingressClassName<span class="token punctuation">:</span> nginx
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> <span class="token string">&quot;hello.atguigu.com&quot;</span>
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> pathType<span class="token punctuation">:</span> Prefix
        path<span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span>
        backend<span class="token punctuation">:</span>
          service<span class="token punctuation">:</span>
            name<span class="token punctuation">:</span> hello<span class="token operator">-</span>server
            port<span class="token punctuation">:</span>
              number<span class="token punctuation">:</span> <span class="token number">8000</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> <span class="token string">&quot;demo.atguigu.com&quot;</span>
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> pathType<span class="token punctuation">:</span> Prefix
        path<span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span>  <span class="token comment"># 把请求会转给下面的服务，下面的服务一定要能处理这个路径，不能处理就是404</span>
        backend<span class="token punctuation">:</span>
          service<span class="token punctuation">:</span>
            name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>demo  <span class="token comment">## java，比如使用路径重写，去掉前缀nginx</span>
            port<span class="token punctuation">:</span>
              number<span class="token punctuation">:</span> <span class="token number">8000</span>
        
<span class="token comment">#配置本地域名</span>
vi <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
<span class="token v-string string">3.238.176.211</span> hello<span class="token operator">.</span>atguigu<span class="token operator">.</span>com
<span class="token v-string string">3.238.176.211</span> demo<span class="token operator">.</span>atguigu<span class="token operator">.</span>com


          
<span class="token comment"># 测试访问:</span>
查询ingress service的node port端口
 kubectl get pod<span class="token punctuation">,</span>svc <span class="token operator">-</span>n ingress<span class="token operator">-</span>nginx

NAME                                         TYPE        CLUSTER<span class="token operator">-</span>IP      EXTERNAL<span class="token operator">-</span>IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
service<span class="token operator">/</span>ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller             NodePort    <span class="token v-string string">10.96.231.254</span>   <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">31623</span><span class="token operator">/</span>TCP<span class="token punctuation">,</span><span class="token number">443</span><span class="token punctuation">:</span><span class="token number">30811</span><span class="token operator">/</span>TCP   170m
service<span class="token operator">/</span>ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller<span class="token operator">-</span>admission   ClusterIP   <span class="token v-string string">10.96.72.253</span>    <span class="token filehandle symbol">&lt;none&gt;</span>        <span class="token number">443</span><span class="token operator">/</span>TCP                      170m


<span class="token comment">#在防火墙中开放31623端口</span>

<span class="token comment">#访问</span>
http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/hello.atguigu.com:31623/</span>
Hello World<span class="token operator">!</span>

http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/demo.atguigu.com:31623/</span>
Welcome to nginx<span class="token operator">!</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>service 中port 和nodeport的区别</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code> port 是 Service 暴露给集群内其他组件（例如其他 Pod）的端口号<span class="token punctuation">,</span>例如ingress 直接可以用<span class="token operator">.</span>
 它表示你可以通过 Service 名称和这个端口号来访问 Service。port 是 Service 自身的端口，用于集群内部的 Pod 通信。外部流量无法直接通过这个端口访问 Service。
 
 NodePort 是一种 Kubernetes Service 类型，用于将服务暴露到集群外部。它在每个节点上开放一个高位端口，然后将外部流量通过这个节点端口转发到 Service 的 port 上。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>pv 和pvc</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#安装nfs (每个机器都安装)</span>
sudo apt update

<span class="token comment">#在主节点中安装 </span>
sudo apt install nfs<span class="token operator">-</span>kernel<span class="token operator">-</span>server nfs<span class="token operator">-</span>common

<span class="token comment">#在主节点中操作</span>
<span class="token comment">#创建同步文件夹</span>
mkdir <span class="token operator">-p</span> <span class="token operator">/</span>nfs<span class="token operator">/</span>data
<span class="token comment">#配置NFS 服务器</span>
<span class="token comment">#nfs主节点</span>
echo <span class="token string">&quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot;</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>exports

systemctl enable rpcbind <span class="token operator">--</span>now
systemctl enable nfs<span class="token operator">-</span>server <span class="token operator">--</span>now
<span class="token comment">#导出生效(主节点操作)</span>
sudo exportfs <span class="token operator">-</span>ra
<span class="token comment">#启动nfs(主节点操作)</span>
sudo systemctl start nfs<span class="token operator">-</span>kernel<span class="token operator">-</span>server

<span class="token comment">#在从从节点中安装</span>

sudo apt install nfs<span class="token operator">-</span>common

mkdir <span class="token operator">-p</span> <span class="token operator">/</span>nfs<span class="token operator">/</span>data
<span class="token comment">#执行以下命令挂载 nfs 服务器上的共享目录</span>
mount <span class="token operator">-t</span> nfs <span class="token v-string string">172.31.70.77</span><span class="token punctuation">:</span><span class="token operator">/</span>nfs<span class="token operator">/</span>data <span class="token operator">/</span>nfs<span class="token operator">/</span>data <span class="token comment">#172.31.70.77 是aws的私有地址</span>

<span class="token comment"># 写入一个测试文件</span>
echo <span class="token string">&quot;hello nfs server&quot;</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>nfs<span class="token operator">/</span>data<span class="token operator">/</span>test<span class="token operator">.</span>txt

<span class="token comment">#pv 和pvc</span>
<span class="token comment">#PV：持久卷（Persistent Volume），将应用需要持久化的数据保存到指定位置</span>
<span class="token comment">#PVC：持久卷申明（Persistent Volume Claim），申明需要使用的持久卷规格</span>

<span class="token comment">#创建pv</span>
<span class="token comment">#pv.yml</span>

apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> PersistentVolume
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> p<span class="token v-string string">v01</span>
spec<span class="token punctuation">:</span>
  capacity<span class="token punctuation">:</span>
    storage<span class="token punctuation">:</span> 1000M
  accessModes<span class="token punctuation">:</span>
    <span class="token operator">-</span> ReadWriteMany
  storageClassName<span class="token punctuation">:</span> nfs
  nfs<span class="token punctuation">:</span>
    path<span class="token punctuation">:</span> <span class="token operator">/</span>nfs<span class="token operator">/</span>data<span class="token operator">/</span><span class="token number">01</span>
    server<span class="token punctuation">:</span> <span class="token v-string string">172.31.70.77</span>

<span class="token comment">#执行</span>
kebuctl apply <span class="token operator">-f</span> pv<span class="token operator">.</span>yml

<span class="token comment">#pvc 创建与绑定</span>

kind<span class="token punctuation">:</span> PersistentVolumeClaim
apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> logs<span class="token operator">-</span>pvc
spec<span class="token punctuation">:</span>
  accessModes<span class="token punctuation">:</span>
    <span class="token operator">-</span> ReadWriteMany
  resources<span class="token punctuation">:</span>
    requests<span class="token punctuation">:</span>
      storage<span class="token punctuation">:</span> 900Mi
  storageClassName<span class="token punctuation">:</span> nfs

<span class="token comment">#创建一个service和deployment,测试</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建一个service和deployment,测试</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>apiVersion<span class="token punctuation">:</span> <span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>servie
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>service
  <span class="token comment"># 命名空间，没有可以删除，默认是default</span>
  namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
spec<span class="token punctuation">:</span>
  ports<span class="token punctuation">:</span>
  <span class="token comment"># 对外暴露的端口</span>
  <span class="token operator">-</span> nodePort<span class="token punctuation">:</span> <span class="token number">30002</span>
    port<span class="token punctuation">:</span> <span class="token number">80</span>
    protocol<span class="token punctuation">:</span> TCP
    targetPort<span class="token punctuation">:</span> <span class="token number">80</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
  <span class="token comment"># NodePort类型可以对外暴露端口</span>
  type<span class="token punctuation">:</span> NodePort

<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span><span class="token v-string string">v1</span>
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>deploy
  name<span class="token punctuation">:</span> nginx<span class="token operator">-</span>deploy
  namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">1</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pod
      namespace<span class="token punctuation">:</span> <span class="token keyword">default</span>
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
    <span class="token comment"># 镜像名称</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token v-string string">1.22.0</span>
        name<span class="token punctuation">:</span> nginx
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
        resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        volumeMounts<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> html
          mountPath<span class="token punctuation">:</span> <span class="token operator">/</span>usr<span class="token regex">/share/ngin</span><span class="token operator">x</span><span class="token operator">/</span>html
      volumes<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> html
          persistentVolumeClaim<span class="token punctuation">:</span>
            claimName<span class="token punctuation">:</span> nginx<span class="token operator">-</span>pvc

     
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建文件</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token comment">#在任何一台机器上</span>
<span class="token comment">#/nfs/data/01</span>
<span class="token comment">#创建index.html 文件</span>
<span class="token filehandle symbol">&lt;html&gt;</span><span class="token number">123</span><span class="token filehandle symbol">&lt;/html&gt;</span>

<span class="token comment">#访问</span>
http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/3.238.176.211:30002/</span>
<span class="token number">123</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li></li><li></li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/lyl468lyl/blog/edit/main/docs/study/erpnext sass化.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: liyulong@szwanggu.com">liyulong</span><!--]--><!--]--></div></div></footer><!----><div class="giscus-wrapper input-top" id="comment" style="display:none;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">我是个神人</div><div class="vp-copyright">Copyright © 2023 龙哥</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-c74164ac.js" defer></script>
  </body>
</html>
