import{_ as n,o as s,c as a,e as p}from"./app-06032555.js";const e={},t=p(`<h1 id="clickhouse随手笔记" tabindex="-1"><a class="header-anchor" href="#clickhouse随手笔记" aria-hidden="true">#</a> clickhouse随手笔记</h1><p>![image-20220305154136568](/Users/li/Library/Application Support/typora-user-images/image-20220305154136568.png)</p><p>![image-20220305155923527](/Users/li/Library/Application Support/typora-user-images/image-20220305155923527.png)</p><p>![image-20220305155942511](/Users/li/Library/Application Support/typora-user-images/image-20220305155942511.png)</p><p>下载地址:</p><p>https://repo.yandex.ru/clickhouse/rpm/stable/x86_64/</p><p>![image-20220305162326551](/Users/li/Library/Application Support/typora-user-images/image-20220305162326551.png)</p><p>![image-20220305164106829](/Users/li/Library/Application Support/typora-user-images/image-20220305164106829.png)</p><p>![image-20220305164722347](/Users/li/Library/Application Support/typora-user-images/image-20220305164722347.png)</p><p>![image-20220305165819326](/Users/li/Library/Application Support/typora-user-images/image-20220305165819326.png)</p><p>![image-20220305170431547](/Users/li/Library/Application Support/typora-user-images/image-20220305170431547.png)</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token punctuation">[</span>root<span class="token variable">@centos01</span> clickhouse<span class="token punctuation">]</span><span class="token comment"># rpm -ivh *.rpm --force --nodeps</span>

<span class="token operator">//</span>删除rpm包
<span class="token punctuation">[</span>root<span class="token variable">@centos01</span> clickhouse<span class="token punctuation">]</span><span class="token comment"># rpm -evh --nodeps clickhouse-client-21.7.3.14-2.noarch</span>

<span class="token punctuation">[</span>root<span class="token variable">@centos01</span> clickhouse<span class="token punctuation">]</span><span class="token comment"># clickhouse-client --host 192.168.0.185 --password=123456</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code><span class="token operator">--</span>host<span class="token punctuation">,</span> <span class="token operator">-</span>h <span class="token operator">-</span>– 服务端的host名称<span class="token punctuation">,</span> 默认是localhost。您可以选择使用host名称或者IP<span class="token v-string string">v4</span>或IP<span class="token v-string string">v6</span>地址。
<span class="token operator">--</span>port – 连接的端口，默认值：<span class="token number">9000</span>。注意HTTP接口以及TCP原生接口使用的是不同端口。
<span class="token operator">--</span>user<span class="token punctuation">,</span> <span class="token operator">-u</span> – 用户名。 默认值：<span class="token keyword">default</span>。
<span class="token operator">--</span>password – 密码。 默认值：空字符串。
<span class="token operator">--</span>query<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token string">q – 使用非交互模式查询。
--database, -d –</span> 默认当前操作的数据库<span class="token operator">.</span> 默认值：服务端默认的配置（默认是<span class="token keyword">default</span>）。
<span class="token operator">--</span>multiline<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token regex">m – 如果指定，允许多行语句查询（Enter仅代表换行，不代表查询语句完结）。
--multiquery, -n –</span> 如果指定<span class="token punctuation">,</span> 允许处理用<span class="token punctuation">;</span>号分隔的多个查询，只在非交互模式下生效。
<span class="token operator">--</span>format<span class="token punctuation">,</span> <span class="token operator">-f</span> – 使用指定的默认格式输出结果。
<span class="token operator">--</span>vertical<span class="token punctuation">,</span> <span class="token operator">-</span>E – 如果指定，默认情况下使用垂直格式输出结果。这与–format<span class="token operator">=</span>Vertical相同。在这种格式中，每个值都在单独的行上打印，这种方式对显示宽表很有帮助。
<span class="token operator">--</span>time<span class="token punctuation">,</span> <span class="token operator">-t</span> – 如果指定，非交互模式下会打印查询执行的时间到stderr中。
<span class="token operator">--</span>stacktrace – 如果指定，如果出现异常，会打印堆栈跟踪信息。
<span class="token operator">--</span>config<span class="token operator">-</span>file – 配置文件的名称。
<span class="token operator">--</span>secure – 如果指定，将通过安全连接连接到服务器。
<span class="token operator">--</span>history_file — 存放命令历史的文件的路径。
<span class="token operator">--</span>param_<span class="token filehandle symbol">&lt;name&gt;</span> — 查询参数配置查询参数<span class="token operator">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20220305193453486](/Users/li/Library/Application Support/typora-user-images/image-20220305193453486.png)</p><p>![image-20220305193823073](/Users/li/Library/Application Support/typora-user-images/image-20220305193823073.png)</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>create table t_order_mt3<span class="token punctuation">(</span><span class="token operator">\\</span>
 id UInt32<span class="token punctuation">,</span><span class="token operator">\\</span>
 sku_id String<span class="token punctuation">,</span><span class="token operator">\\</span>
 total_amount Decimal<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> TTL create_time<span class="token operator">+</span>interval <span class="token number">10</span> SECOND<span class="token punctuation">,</span><span class="token operator">\\</span>
 create_time Datetime<span class="token operator">\\</span>
<span class="token punctuation">)</span> engine <span class="token operator">=</span>MergeTree<span class="token operator">\\</span>
partition by toYYYYMMDD<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span><span class="token operator">\\</span>
 primary key <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">\\</span>
 order by <span class="token punctuation">(</span>id<span class="token punctuation">,</span> sku_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>去重只能同一分区内去重</p><p>![image-20220305201943724](/Users/li/Library/Application Support/typora-user-images/image-20220305201943724.png)</p><p>![image-20220305201956561](/Users/li/Library/Application Support/typora-user-images/image-20220305201956561.png)</p><p>![image-20220305202600686](/Users/li/Library/Application Support/typora-user-images/image-20220305202600686.png)</p><p>![image-20220305204507504](/Users/li/Library/Application Support/typora-user-images/image-20220305204507504.png)</p><p>groupie 去重:</p><p>测试:</p><p>先创建个表:</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>create table temp1<span class="token punctuation">(</span><span class="token operator">\\</span>
id UInt32<span class="token punctuation">,</span><span class="token operator">\\</span>
sku_id String<span class="token punctuation">,</span><span class="token operator">\\</span>
total_amount Decimal<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
create_time Datetime<span class="token operator">\\</span>
<span class="token punctuation">)</span> engine <span class="token operator">=</span>ReplacingMergeTree<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span><span class="token operator">\\</span>
partition by toYYYYMMDD<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span><span class="token operator">\\</span>
primary key <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">\\</span>
order by <span class="token punctuation">(</span>id<span class="token punctuation">,</span> sku_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>插入数据</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>insert into temp1 values<span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">&#39;sku_001&#39;</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 12:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-03 11:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_004&#39;</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 12:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 13:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">12000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 13:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-02 12:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20220305221534028](/Users/li/Library/Application Support/typora-user-images/image-20220305221534028.png)</p><p>只能在分区中去重</p><p>再次插入数据重复的</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>insert into temp1 values<span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">&#39;sku_001&#39;</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 12:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 11:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_004&#39;</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 12:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 13:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">12000.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-01 13:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">\\</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;sku_002&#39;</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">&#39;2020-06-02 12:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为新建数据在临时分区,只有合并分区,才能把数据去重.(这需要时间)</p><p>使用groupby</p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>SELECT id<span class="token punctuation">,</span>sku_id<span class="token punctuation">,</span>argMax<span class="token punctuation">(</span>total_amount<span class="token punctuation">,</span>create_time<span class="token punctuation">)</span> as amount <span class="token punctuation">,</span>max<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span> AS ctime　FROM temp1　GROUP BY <span class="token punctuation">(</span>id<span class="token punctuation">,</span>sku_id<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20220305221618164](/Users/li/Library/Application Support/typora-user-images/image-20220305221618164.png)</p><p>![image-20220305222143697](/Users/li/Library/Application Support/typora-user-images/image-20220305222143697.png)</p><p>副本同步</p><p>![image-20220306095446251](/Users/li/Library/Application Support/typora-user-images/image-20220306095446251.png)</p><p>https://www.cnblogs.com/shengyang17/p/14282944.html</p><p>![image-20220306095410812](/Users/li/Library/Application Support/typora-user-images/image-20220306095410812.png)</p>`,40),o=[t];function i(c,l){return s(),a("div",null,o)}const u=n(e,[["render",i],["__file","clickhouse随手笔记.html.vue"]]);export{u as default};
