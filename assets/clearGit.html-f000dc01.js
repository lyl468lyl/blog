import{_ as s,r as i,o as r,c as t,a,b as e,d as l,e as c}from"./app-c9231c3a.js";const d={},p=a("h1",{id:"处理项目git记录过大的问题",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#处理项目git记录过大的问题","aria-hidden":"true"},"#"),e(" 处理项目Git记录过大的问题")],-1),o=a("blockquote",null,[a("p",null,"之前在代码推送记录中提交记录中包含很多地图变动信息，每次变动包含5千左右的png变动信息导致git超过1G无法clone")],-1),u=a("h2",{id:"git永久删除文件和历史记录",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#git永久删除文件和历史记录","aria-hidden":"true"},"#"),e(" Git永久删除文件和历史记录")],-1),v={href:"https://www.cnblogs.com/shines77/p/3460274.html",target:"_blank",rel:"noopener noreferrer"},m=c(`<h3 id="使用filter-branch命令" tabindex="-1"><a class="header-anchor" href="#使用filter-branch命令" aria-hidden="true">#</a> 使用filter-branch命令</h3><div class="language-git line-numbers-mode" data-ext="git"><pre class="language-git"><code><span class="token command">$ git filter-branch<span class="token parameter"> --force</span><span class="token parameter"> --index</span>-filter \\</span>
<span class="token string">&#39;git rm --cached --ignore-unmatch PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA&#39;</span> \\
<span class="token deleted">--prune-empty --tag-name-filter cat -- --all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中, PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA 就是你要删除的文件的相对路径(相对于git仓库的根目录), 替换成你要删除的文件路径即可. 注意一点，这里的文件或文件夹，如果以 &#39;/&#39; 开头，则文件或文件夹会被认为是从 git 的安装目录开始。</p><p>如果你要删除的目标不是文件，而是文件夹，那么请在 git rm --cached 命令后面添加 -r 命令，表示递归的删除（子）文件夹和文件夹下的文件，类似于 rm -rf 命令。</p><p>例如：</p><div class="language-git line-numbers-mode" data-ext="git"><pre class="language-git"><code>git filter-branch --force --index-filter <span class="token string">&#39;git rm --cached -r --ignore-unmatch ./public/img/map/&#39;</span> --prune-empty --tag-name-filter cat -- --all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>注意： 输入命令前需要将所有分支代码拉取到本地</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> fetch <span class="token parameter variable">--all</span>
<span class="token comment"># 追踪所有分支</span>
<span class="token function">git</span> branch <span class="token parameter variable">-r</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&#39;\\-&gt;&#39;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> remote<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">git</span> branch <span class="token parameter variable">--track</span>
<span class="token function">git</span> pull <span class="token parameter variable">--all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果显示 xxxxx unchanged, 说明repo里没有找到该文件, 需检查路径和文件名是否正确.</p><h3 id="推送修改后的代码" tabindex="-1"><a class="header-anchor" href="#推送修改后的代码" aria-hidden="true">#</a> 推送修改后的代码</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> push origin master <span class="token parameter variable">--force</span> <span class="token parameter variable">--all</span> <span class="token parameter variable">--tags</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="清理和回收空间" tabindex="-1"><a class="header-anchor" href="#清理和回收空间" aria-hidden="true">#</a> 清理和回收空间</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-rf</span> .git/refs/original/
<span class="token function">git</span> reflog expire <span class="token parameter variable">--expire</span><span class="token operator">=</span>now <span class="token parameter variable">--all</span>
<span class="token function">git</span> gc <span class="token parameter variable">--prune</span><span class="token operator">=</span>now
<span class="token function">git</span> gc <span class="token parameter variable">--aggressive</span> <span class="token parameter variable">--prune</span><span class="token operator">=</span>now
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="优化git" tabindex="-1"><a class="header-anchor" href="#优化git" aria-hidden="true">#</a> 优化Git</h2><h3 id="将地图打包成zip文件" tabindex="-1"><a class="header-anchor" href="#将地图打包成zip文件" aria-hidden="true">#</a> 将地图打包成zip文件</h3><p>将地图图片打包成zip文件，使用每次构建时自动解压文件</p><ol><li><p>安装extract-zip-relative-path</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i --save-dev extract-zip-relative-path
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>每次启动或打包前先解压文件 修改package.json文件中的脚本部分</p><div class="language-diff line-numbers-mode" data-ext="diff"><pre class="language-diff"><code>&quot;serve&quot;: &quot;vue-cli-service serve&quot;,
&quot;build&quot;: &quot;vue-cli-service build&quot;,
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &quot;preserve&quot;: &quot;extract-zip ./maptool/map.zip ./public/img&quot;,
</span><span class="token prefix inserted">+</span><span class="token line"> &quot;prebuild&quot;: &quot;extract-zip ./maptool/map.zip ./public/img&quot;
</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="编辑-gitignore" tabindex="-1"><a class="header-anchor" href="#编辑-gitignore" aria-hidden="true">#</a> 编辑.gitignore</h3><div class="language-diff line-numbers-mode" data-ext="diff"><pre class="language-diff"><code>node_modules
/dist
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> public/img/map/
</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19);function h(g,b){const n=i("ExternalLinkIcon");return r(),t("div",null,[p,o,u,a("p",null,[e("参考"),a("a",v,[e("https://www.cnblogs.com/shines77/p/3460274.html"),l(n)])]),m])}const k=s(d,[["render",h],["__file","clearGit.html.vue"]]);export{k as default};
